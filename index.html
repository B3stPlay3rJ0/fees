<!doctype html>
<html lang="en">
<head>
  <!-- FullCalendar CSS -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet" />

  <!-- FullCalendar JS -->
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fees Dashboard — Joanne</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/main.min.js"></script>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--muted:#94a3b8;--accent:#0ea5a4;--danger:#ef4444;--warn:#f59e0b;--ok:#10b981}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#071024 0%,#071827 60%);color:#e6eef6;padding:24px}
    .container{max-width:980px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    p.lead{color:var(--muted);margin:4px 0 0;font-size:13px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:16px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    input.search{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    select,button{padding:8px 10px;border-radius:8px;border:0;background:#082036;color:#cfeef0}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    thead th{font-size:12px;text-align:left;padding:10px 8px;color:var(--muted);border-bottom:1px solid rgba(255,255,255,0.03)}
    tbody td{padding:10px 8px;border-bottom:1px solid rgba(255,255,255,0.02);font-size:14px}
    .fee-type{font-weight:600}
    .notes{color:var(--muted);font-size:13px}
    .pill{display:inline-block;padding:6px 8px;border-radius:999px;font-size:12px}
    .status-overdue{background:rgba(239,68,68,0.12);color:var(--danger);border:1px solid rgba(239,68,68,0.18)}
    .status-due{background:rgba(245,158,11,0.08);color:var(--warn);border:1px solid rgba(245,158,11,0.12)}
    .status-future{background:rgba(16,185,129,0.08);color:var(--ok);border:1px solid rgba(16,185,129,0.12)}
    .small{font-size:12px;color:var(--muted)}
    footer{display:flex;justify-content:space-between;align-items:center;margin-top:14px}
    .totals{font-weight:700}
    .actions{display:flex;gap:8px}
    #calendar{margin-top:20px;background:#0b1220;border-radius:12px;padding:10px}
    @media (max-width:720px){thead th:nth-child(3),thead th:nth-child(4){display:none}tbody td:nth-child(3),tbody td:nth-child(4){display:none}}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Fees Dashboard — Joanne</h1>
        <p class="lead">Clean view of due dates, totals and quick actions. (Local date: 14 Nov 2025)</p>
      </div>
      <div class="small">Business style • Mobile-friendly</div>
    </header>

    <div class="card">
      <div class="controls">
        <input class="search" id="search" placeholder="Search fee type, notes or amount" />
        <select id="filter">
          <option value="all">All categories</option>
        </select>
        <button id="sortDate">Sort by due date</button>
        <button id="export">Export CSV</button>
        <button id="print">Print</button>
      </div>

      <div id="tableWrap">
        <table id="feesTable">
          <thead>
            <tr>
              <th>Fee Type</th>
              <th>Description</th>
              <th>Amount (RM)</th>
              <th>Due Date</th>
              <th>Notes</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="calendar"></div>

      <footer>
        <div class="small totals" id="summary">Total: RM 0.00 — Upcoming within 14 days: 0</div>
        <div class="actions small">Built for your dad ✓</div>
      </footer>
    </div>
  </div>

  <script>
    const fees = [
      {type:'School Fees', desc:'Summer Semester (2 units)', amount:16663.20, due:'2025-12-04', notes:''},
      {type:'Exchange, School Fees', desc:'Exchange Semester (3 units)', amount:24994.80, due:'2026-03-06', notes:''},
      {type:'Club Related Fees', desc:'Accommodation + Flight', amount:3010.00, due:'2025-12-28', notes:'Upfront payment. Will be reimbursed by Feb 2026'},
      {type:'Exchange, Misc', desc:'Insurance', amount:1346.87, due:'2025-11-14', notes:'Need to do this to accept offer letter'},
      {type:'Exchange, Misc', desc:'Visa', amount:5420.00, due:'2026-01-02', notes:'Need to apply 4 weeks in advance of arrival. The earlier, the better'},
      {type:'Exchange, Misc', desc:'Melbourne Flight', amount:4763.00, due:'2026-11-21', notes:'As of 14/11/2025 - Return Flight - Unlimited Rebooking with fare changes'},
      {type:'Exchange, Accoms', desc:'Accommondation — 813 MYR/week (2 weeks)', amount:1626.00, due:'2026-03-01', notes:'First 2 weeks — Feb 15 - 1 Mar'},
      {type:'Exchange, Accoms', desc:'Accommondation — 813 MYR/week (4 weeks)', amount:3252.00, due:'2026-03-29', notes:'Week 3 - 6 — 1 Mar - 29 Mar'},
      {type:'Exchange, Accoms', desc:'Accommondation — 813 MYR/week (4 weeks)', amount:3252.00, due:'2026-04-26', notes:'Week 7 - 10 — 29 Mar - 26 Apr'},
      {type:'Exchange, Accoms', desc:'Accommondation — 813 MYR/week (4 weeks)', amount:3252.00, due:'2026-05-24', notes:'Week 11 - 14 — 26 Apr - 24 May'},
      {type:'Exchange, Accoms', desc:'Accommondation — 813 MYR/week (4 weeks)', amount:3252.00, due:'2026-06-21', notes:'Week 15 - 18 — 24 May - 21 Jun'},
      {type:'Exchange, Accoms', desc:'Accommondation — 813 MYR/week (2 weeks)', amount:1626.00, due:'2026-07-05', notes:'Week 19 - 20 — 21 Jun - 5 Jul'}
    ];

    const today = new Date('2025-11-14T00:00:00');

    function formatDate(iso){
      const d = new Date(iso + 'T00:00:00');
      return new Intl.DateTimeFormat(undefined,{day:'2-digit',month:'short',year:'numeric'}).format(d);
    }

    function daysBetween(iso){
      const d = new Date(iso + 'T00:00:00');
      const ms = d - today;
      return Math.round(ms / (1000*60*60*24));
    }

    function statusFor(days){
      if(days < 0) return {cls:'status-overdue', text:'Overdue'};
      if(days === 0) return {cls:'status-due', text:'Due today'};
      if(days <= 14) return {cls:'status-due', text:`Due in ${days} day${days>1?'s':''}`};
      return {cls:'status-future', text:`In ${days} day${days>1?'s':''}`};
    }

    const filterEl = document.getElementById('filter');
    const categories = Array.from(new Set(fees.map(f=>f.type)));
    categories.forEach(c=>{const o=document.createElement('option');o.value=c;o.textContent=c;filterEl.appendChild(o)});

    function render(rows){
      const tbody = document.querySelector('#feesTable tbody');
      tbody.innerHTML='';
      let total = 0; let upcomingCount = 0;
      rows.forEach(r=>{
        total += r.amount;
        const days = daysBetween(r.due);
        const stat = statusFor(days);
        if(days >=0 && days <=14) upcomingCount++;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td class="fee-type">${escapeHtml(r.type)}</td>
          <td class="notes">${escapeHtml(r.desc)}</td>
          <td>RM ${r.amount.toFixed(2)}</td>
          <td>${formatDate(r.due)}</td>
          <td class="notes">${escapeHtml(r.notes)}</td>
          <td><span class="pill ${stat.cls}">${stat.text}</span></td>
        `;
        tbody.appendChild(tr);
      });
      document.getElementById('summary').textContent = `Total: RM ${total.toFixed(2)} — Upcoming within 14 days: ${upcomingCount}`;
      renderCalendar(rows);
    }

    function escapeHtml(s){return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')}

    render(fees);

    document.getElementById('search').addEventListener('input',e=>{
      const q = e.target.value.toLowerCase();
      const cat = filterEl.value;
      const filtered = fees.filter(f=>{
        if(cat!=='all' && f.type!==cat) return false;
        return (f.type+f.desc+f.notes+f.amount).toLowerCase().includes(q);
      });
      render(filtered);
    });

    filterEl.addEventListener('change',()=>document.getElementById('search').dispatchEvent(new Event('input')));

    let asc = true;
    document.getElementById('sortDate').addEventListener('click',()=>{
      const copy = [...fees].sort((a,b)=> new Date(a.due) - new Date(b.due));
      if(!asc) copy.reverse();
      asc = !asc;
      render(copy);
    });

    document.getElementById('export').addEventListener('click',()=>{
      const header = ['Fee Type','Description','Amount (RM)','Due Date','Notes'];
      const rows = [header].concat(fees.map(f=>[f.type,f.desc,f.amount.toFixed(2),formatDate(f.due),f.notes]));
      const csv = rows.map(r=>r.map(c=>`"${String(c).replace(/"/g,'""') }"`).join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'fees.csv'; a.click(); URL.revokeObjectURL(url);
    });

    document.getElementById('print').addEventListener('click',()=>window.print());

    // Calendar view
    function renderCalendar(rows){
      const calEl = document.getElementById('calendar');
      calEl.innerHTML='';
      const events = rows.map(r=>({
        title: `${r.type}: RM${r.amount.toFixed(2)}`,
        start: r.due,
        extendedProps: {desc: r.desc, notes: r.notes}
      }));
      const calendar = new FullCalendar.Calendar(calEl, {
        initialView: 'dayGridMonth',
        height: 550,
        events: events,
        eventDidMount: info => {
          const tip = `${info.event.extendedProps.desc}\n${info.event.extendedProps.notes}`;
          info.el.title = tip;
        }
      });
      calendar.render();
    }
  </script>
</body>
</html>
